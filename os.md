## 基础

### 内核（kernel）

控制计算机硬件资源，提供程序运行环境。

### 系统调用（system call）

- 内核接口，由此程序向内核请求服务。公用函数库建在系统调用之上，应用程序既可使用公用函数库，也可使用系统调用。
- 从实现者角度，系统调用和库函数有根本的区别。从用户角度，其区别并不重要。
  - 系统调用通常提供一种最小接口，而库函数通常提供比较复杂的功能。

### 程序（program）

一个存储在磁盘某个目录中的可执行文件。内核使用 exec 函数将程序读入内存，并执行程序。

### 进程（process）

- 程序的执行实例。
- 每个进程都有一个唯一的数字标识，进程 ID（process ID），总是一个非负整数

### 线程（thread）

- 通常一个进程只有一个控制线程——某一时刻执行的一组机器指令。对于某些问题，如果有多个控制线程分别作用于它的不同部分，那么解决起来就容易得多。也可以充分利用多处理器的并行能力。
- 一个进程内的所有线程共享同一地址空间、文件描述符、栈以及与进程相关的属性。因为他们能访问同一存储区，所以各线程在访问共享数据时需要采取同步措施以避免不一致性。
- 线程也用 ID（thread ID）标识，但只在它所属的进程内起作用。

### 信号（signal）

- 用于通知进程发生了某种情况。
- 进程处理信号方式：
  - 忽略。后果不确定，不推荐。
  - 系统默认方式处理。
  - 提供信号处理函数，按照期望的方式处理。
- 向一个进程发送信号时，必须使进程所有者或者超级用户。

## Unix 标准及其实现

- ISO C
- POSIX: 可移植操作系统接口（Portable Operating System Interface）
- GNU/Linux

## 文件 I/O

- 对内核而言，所有打开的文件都用文件描述符引用。文件描述符是一个非负整数。当打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。当读、写一个文件时，使用 open 或 create 返回的文件描述符标识该文件，将其作为参数传给 read 或 write。
- 文件描述符惯例
  - STDIN_FILENO：0 // 进程的标准输入
  - STDOUT_FILENO：1 // 进程的标准出
  - STDERR_FILENO：2 // 进程的标准错误
- open/create
  - 打开或创建一个文件
- read
- write
- lseek
- close
  - 关闭一个打开文件

## 文件和目录

- 文件类型
  - 普通文件（regular file）。包含某种形式的数据。文本或二进制对于内核并无区别，由处理该文件的应用程序进行解释。
  - 目录文件（directory file）。包含其他文件的名字和指针。有读权限的进程可以读该目录的内容，但只有内核可以直接写。
  - 块特殊文件（block special file）。提供对设备（如磁盘）带缓冲的访问，每次访问以固定长度为单位进行。FreeBSD 不再支持。
  - 字符特殊文件（character special file）。提供对设备不带缓冲的访问，访问长度可变。系统中所有设备要么是字符特殊文件，要么是块特殊文件。
  - FIFO。用于进程间通信（IPC）。也成为命名管道（named pipe）。
  - 套接字（socket）。用于进程间通信。
  - 符号链接（symbol link）。指向另一个文件。

## 进程

- C 程序存储空间布局
  - 正文段。机器指令。通常可共享、只读。// \_\_TEXT
  - 数据段。程序中需要明确赋初值的变量。// \_\_DATA
  - 栈。自动变量以及每次函数调用需要保存的信息（返回地址、调用者环境信息）。然后，最近被调用的函数在栈上为其自动和临时变量分配存储空间。
  - 堆。动态存储分配。
- 共享库
  - 使得可执行文件不再需要包含公用的库函数，而只需在所有进程可以引用的存储区种保存这个库例程的一个副本。
  - 程序第一次执行或者第一次调用某个库函数时，用动态链接方法将程序与共享库函数链接。
  - 减少了每个可执行文件的长度，增加了一些运行时间开销。开销发生在程序第一次被执行或者每个共享库函数第一次被调用时。
  - 另一个优点是可以用库函数的新版本代替老版本而无需对使用该库的程序重新连接编辑。
- 存储空间分配
  - malloc
  - free
- 环境变量
  - name=value
  - 内核不查看这些字符串，解释完全取决于各个应用程序
- fork
  - 创建一个新进程。由 fork 创建的新进程被称为子进程（child process）。fork 函数被调用一次，但返回两次。两次返回的区别是子进程的返回值是 0，父进程的返回值是新建子进程的进程 ID。
- exec

## 参考书目和文献

- W.Richard Stevens, Stephen A. Rago. Advanced Programming in the Unix Environment. 3rd Edition. 2013. 戚正伟, 张亚英, 尤晋元 译. 人民邮电出版社, 2014.
